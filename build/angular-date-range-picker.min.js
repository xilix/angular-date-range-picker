/*! angular-date-range-picker 2015-04-15 */
(function(){angular.module("dateRangePicker",["pasvaz.bindonce"]),angular.module("dateRangePicker").directive("dateRangePicker",["$compile","$timeout",function(a,b){var c,d;return d='<div ng-show="visible" class="angular-date-range-picker__picker scale-fade" ng-click="handlePickerClick($event)" ng-class="{\'angular-date-range-picker--ranged\': showRanged }">\n  <div class="msgTopDatePicker"><div class="msgTopStartDatePicker">Start</div><div class="msgTopEndDatePicker">End</div></div>\n  <div class="angular-date-range-picker__timesheet" ng-repeat="month in months track by $index">\n    <a ng-click="month.move(-1, $event)" class="angular-date-range-picker__prev-month">&#9664;</a>\n    <div bindonce class="angular-date-range-picker__month">\n      <div class="angular-date-range-picker__month-name">{{month.name}} {{month.year}}</div>\n      <table class="angular-date-range-picker__calendar">\n        <tr>\n          <th bindonce ng-repeat="day in month.weeks[1]" class="angular-date-range-picker__calendar-weekday" bo-text="day.date.format(\'dd\')">\n          </th>\n        </tr>\n        <tr bindonce ng-repeat="week in month.weeks">\n          <td\n              bo-class=\'{\n                "angular-date-range-picker__calendar-day": day,\n                "angular-date-range-picker__calendar-day-selected": day.selected,\n                "angular-date-range-picker__calendar-day-disabled": day.disabled,\n                "angular-date-range-picker__calendar-day-start": day.start\n              }\'\n              ng-repeat="day in week track by $index" ng-click="select(day, month.end, $event)">\n              <div class="angular-date-range-picker__calendar-day-wrapper" bo-text="day.date.date()"></div>\n          </td>\n        </tr>\n      </table>\n    </div>\n    <a ng-click="month.move(+1, $event)" class="angular-date-range-picker__next-month">&#9654;</a>\n  </div>\n  <div class="angular-date-range-picker__panel">\n    <div ng-show="showRanged">\n      Select range: <select ng-click="prevent_select($event)" ng-model="quick" ng-options="e.range as e.label for e in quickList"></select>\n    </div>\n    <div class="angular-date-range-picker__buttons" ng-show="!applyOnSelect">\n      <a ng-click="ok($event)" class="angular-date-range-picker__apply">{{ textApply || "Apply"}}</a>\n      <a ng-click="hide($event)" class="angular-date-range-picker__cancel">{{ textCancel || "Cancel" }}</a>\n    </div>\n  </div>\n</div>',c="CUSTOM",{restrict:"AE",replace:!0,template:'<span tabindex="0" ng-keydown="hide()" class="angular-date-range-picker__input">\n  <span ng-if="showRanged">\n    <span ng-show="!!model">{{ model.start.format("ll") }} - {{ model.end.format("ll") }}</span>\n    <span ng-hide="!!model">Select date range</span>\n  </span>\n  <span ng-if="!showRanged">\n    <span ng-show="!!model">{{ model.format("ll") }}</span>\n    <span ng-hide="!!model">Select date</span>\n  </span>\n</span>',scope:{model:"=ngModel",customSelectOptions:"=",applyOnSelect:"=",ranged:"=",pastDates:"@",textApply:"@",textCancel:"@",callback:"&"},link:function(e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s;return e.quickListDefinitions=e.customSelectOptions,null==e.quickListDefinitions&&(e.quickListDefinitions=[{label:"This week",range:moment().range(moment().startOf("week").startOf("day"),moment().endOf("week").startOf("day"))},{label:"Next week",range:moment().range(moment().startOf("week").add(1,"week").startOf("day"),moment().add(1,"week").endOf("week").startOf("day"))},{label:"This fortnight",range:moment().range(moment().startOf("week").startOf("day"),moment().add(1,"week").endOf("week").startOf("day"))},{label:"This month",range:moment().range(moment().startOf("month").startOf("day"),moment().endOf("month").startOf("day"))},{label:"Next month",range:moment().range(moment().startOf("month").add(1,"month").startOf("day"),moment().add(1,"month").endOf("month").startOf("day"))}]),e.quick=null,e.range=null,e.selecting=!1,e.selectingEnded=!1,e.visible=!1,e.start=null,e.showRanged=void 0===e.ranged?!0:e.ranged,m=function(a){var b,d,f,g,h;if(null==a&&(a=!1),e.showRanged){for(e.quickList=[],a&&e.quickList.push({label:"Custom",range:c}),g=e.quickListDefinitions,h=[],d=0,f=g.length;f>d;d++)b=g[d],h.push(e.quickList.push(b));return h}},j=function(){var a,b;return e.showRanged?(e.range=e.selection?(b=e.selection.start.clone().startOf("month").startOf("day"),a=e.selection.end.clone().endOf("month").startOf("day"),moment().range(b,a)):moment().range(moment().startOf("month").startOf("day"),moment().endOf("month").endOf("day")),e.model&&e.model.start&&(e.start=e.model.start),e.model&&e.model.end&&(e.end=e.model.end),e.start&&e.end?e.selection=moment().range(e.start,e.end):void 0):(e.selection=!1,e.selection=e.model||!1,e.date=moment(e.model)||moment(),e.range=moment().range(moment(e.date).startOf("month"),moment(e.date).endOf("month")))},k=function(){var a,b,d,f;if(e.showRanged&&e.selection){for(f=e.quickList,b=0,d=f.length;d>b;b++)if(a=f[b],a.range!==c&&e.selection.start.startOf("day").unix()===a.range.start.startOf("day").unix()&&e.selection.end.startOf("day").unix()===a.range.end.startOf("day").unix())return e.quick=a.range,void m();return e.quick=c,m(!0)}},p=function(a,b){var c,d;return d=moment().startOf("week").day(),c=moment().range(a.startOf("month").startOf("day").toDate().getTime(),a.endOf("month").endOf("day").toDate().getTime()),c.by("days",function(a){var c,f,g,h,i,j,k,l,m,n,o;return c=a.day()-d,0>c&&(c=7+c),k=parseInt((7+a.date()-c)/7),i=0,j=!1,g=!1,h=!1,e.showRanged?(e.start&&(j=a===e.start,g=a<e.start),e.end&&(j=a===e.end,h=a>e.end),e.start&&e.end&&(j=e.selection&&e.selection.contains(a))):(j=a.isSame(e.selection),e.pastDates&&(f=moment().diff(a,"days")>0)),b?((l=e.months)[1]||(l[1]={name:a.format("MMMM YYYY"),weeks:[]}),(m=e.months[1].weeks)[k]||(m[k]=[]),e.months[1].weeks[k][c]={date:a,selected:j,disabled:g,start:e.start&&e.start.unix()===a.unix()}):((n=e.months)[0]||(n[0]={name:a.format("MMMM YYYY"),weeks:[]}),(o=e.months[0].weeks)[k]||(o[k]=[]),e.months[0].weeks[k][c]={date:a,selected:j,disabled:h,start:e.start&&e.start.unix()===a.unix()})})},o=function(){var a,b,c,d;for(e.months[0].weeks=[],e.months[1].weeks=[],p(e.range.start,!1),p(e.range.end,!0),d=e.months,b=0,c=d.length;c>b;b++)a=d[b],a.weeks[0]||a.weeks.splice(0,1);return k(),s(e.range),r(e.range),e.selectingEnded&&!e.start&&e.applyOnSelect?(e.selectingEnded=!1,e.ok()):void 0},e.show=function(){return e.selection=e.model,j(),o(),e.visible=!0},e.hide=function(a){return null!=a&&"function"==typeof a.stopPropagation&&a.stopPropagation(),e.visible=!1},e.prevent_select=function(a){return null!=a&&"function"==typeof a.stopPropagation?a.stopPropagation():void 0},e.ok=function(a){return null!=a&&"function"==typeof a.stopPropagation&&a.stopPropagation(),e.model=e.selection,b(function(){return e.callback?e.callback():void 0}),e.hide()},e.select=function(a,b,c){return null!=c&&"function"==typeof c.stopPropagation&&c.stopPropagation(),b&&a.disabled?void 0:(e.selectingEnded=b,e.showRanged?(e.selecting=!e.selecting,b?e.end=a.date:e.start=a.date,e.start&&!e.end&&n(1,l(e.start)-l(e.range.end)),e.start&&e.end&&e.end.diff(e.start)<0&&(n(1,l(e.start)-l(e.end)),e.end=e.start),e.start&&e.end&&(e.selection=moment().range(e.start,e.end))):e.selection=moment(a.date),o())},s=function(a){return e.months[0].name=a.start.format("MMMM"),e.months[0].year=a.start.format("YYYY"),e.months[0].start=!0,e.months[1].name=a.end.format("MMMM"),e.months[1].year=a.end.format("YYYY"),e.months[1].end=!0},l=function(a){return 12*a.year()+a.month()},r=function(a){var b,c;return c=l(a.start),b=l(a.end),e.months[0].hasPrevious=!0,e.months[0].hasNext=!0,e.months[1].hasPrevious=!0,e.months[1].hasNext=!0,c===b?(e.months[0].hasNext=!1,e.months[1].hasPrevious=!1):void 0},n=function(a,b,c){return null!=c&&"function"==typeof c.stopPropagation&&c.stopPropagation(),e.showRanged?e.range=1===a?{start:e.range.start.clone().startOf("month").startOf("day"),end:e.range.end.add(b,"months").endOf("month").endOf("day")}:{start:e.range.start.add(b,"months").startOf("month").startOf("day"),end:e.range.end.clone().endOf("month").endOf("day")}:(e.date.add(b,"months"),e.range={start:moment(e.date).startOf("month"),end:moment(e.date).endOf("month")}),s(e.range),r(e.range),o()},q=function(a){return e.months=[{move:function(a,b){return n(0,a,b)},weeks:[]},{move:function(a,b){return n(1,a,b)},weeks:[]}],s(a),r(a)},e.handlePickerClick=function(a){return null!=a&&"function"==typeof a.stopPropagation?a.stopPropagation():void 0},e.$watch("quick",function(a,b){return a&&a!==c?(e.selection=e.quick,e.selecting=!1,e.start=null,j(),o()):void 0}),e.$watch("customSelectOptions",function(a){return"undefined"!=typeof customSelectOptions&&null!==customSelectOptions?e.quickListDefinitions=a:void 0}),i=a(angular.element(d))(e),f.append(i),f.bind("click",function(a){return null!=a&&"function"==typeof a.stopPropagation&&a.stopPropagation(),e.$apply(function(){return e.visible?e.hide():e.show()})}),h=function(a){return e.$apply(function(){return e.hide()}),!0},angular.element(document).bind("click",h),e.$on("$destroy",function(){return angular.element(document).unbind("click",h)}),m(),j(),q(e.range),o()}}}])}).call(this);